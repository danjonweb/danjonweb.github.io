<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title>Game</title>
    <script type="text/javascript">
        var ENTITIES = [];
        
        // G = Grass
        // R = Road
        var MAP = [
        'R','R','W','W','W','W','W','W','W','W',
        'W','W','W','W','W','W','W','W','W','W',
        'R','W','W','W','R','W','W','W','W','W',
        'R','W','W','W','W','W','W','W','W','W',
        'R','R','R','W','R','W','W','W','W','W',
        'W','W','R','R','R','W','W','W','W','W',
        'R','W','R','W','W','W','W','W','W','W',
        'R','W','W','W','W','W','W','W','W','W',
        'R','W','W','W','W','W','W','W','W','W',
        'R','W','W','W','W','R','W','W','W','W'];
        
        var MAP_PICKUPS = [
        '0','0','0','0','0','0','0','0','0','0',
        '0','0','0','0','0','0','0','0','0','0',
        '0','0','0','0','KR','0','0','0','0','0',
        '0','0','0','0','0','0','0','0','0','0',
        '0','0','0','0','0','0','0','0','0','0',
        '0','0','0','0','0','0','0','0','0','0',
        '0','0','DR','0','0','0','0','0','0','0',
        '0','0','0','0','0','0','0','0','0','0',
        '0','0','0','0','0','0','0','0','0','0',
        '0','0','0','0','0','0','0','0','0','0'];
        
        var PICKUP_IMAGES = {
	        'KR':'data:image/png;base64,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'
        };
        for (var key in PICKUP_IMAGES) {
			if (PICKUP_IMAGES.hasOwnProperty(key)) {
				var data = PICKUP_IMAGES[key];
				PICKUP_IMAGES[key] = new Image();
				PICKUP_IMAGES[key].src = data;
	    	}
		}
        
        // Cells that cannot be walked on
        var MAP_WALLS = ['W'];
        
        var CELL_WIDTH = 36;
        var CELL_HEIGHT = 46;
        var MAP_WIDTH = 10;
        var MAP_HEIGHT = 10;
        var TRANSITION_WIDTH = 3;
        var TIMER_SPEED = 25;
        
        var EdgeTransitions = {
            NSWEEdgeTransition: 0,
            SWEEdgeTransition: 2,
            NWEEdgeTransition: 4,
            WEEdgeTransition: 6,
            NSEEdgeTransition: 8,
            SEEdgeTransition: 10,
            NEEdgeTransition: 12,
            EEdgeTransition: 14,
            NSWEdgeTransition: 16,
            SWEdgeTransition: 18,
            NWEdgeTransition: 20,
            WEdgeTransition: 22,
            NSEdgeTransition: 24,
            SEdgeTransition: 26,
            NEdgeTransition: 28,
            NoEdgeTransition: 30
        }
        
        var CornerTransitions = {
            NoCornerTransition: 0,
            NWCornerTransition: 2,
            NECornerTransition: 4,
            NWNECornerTransition: 6,
            SWCornerTransition: 8,
            NWSWCornerTransition: 10,
            NESWCornerTransition: 12,
            NWNESWCornerTransition: 14,
            SECornerTransition: 16,
            NWSECornerTransition: 18,
            NESECornerTransition: 20,
            NWNESECornerTransition: 22,
            SWSECornerTransition: 24,
            NWSWSECornerTransition: 26,
            NESWSECornerTransition: 28,
            NWNESWSECornerTransition: 30
        }
        
        var EDGE_TRANSITIONS = [];
        var CORNER_TRANSITIONS = [];
        calculateEdgeTransitions();
        calculateCornerTransitions();

        var GAME_TIMER;
        var GAME_CANVAS;
        var GAME_CONTEXT;
        var GAME_COUNT;
        var IS_EXE = false;
        
        function cellAboveCell(n) {
            if (n === -1) {
                return -1;
            }
            if (n - MAP_WIDTH >= 0) {
                return n - MAP_WIDTH;
            } else {
                return -1;
            }
        }
        function cellBelowCell(n) {
            if (n === -1) {
                return -1;
            }
            if (n + MAP_WIDTH < MAP_WIDTH*MAP_HEIGHT) {
                return n + MAP_WIDTH;
            } else {
                return -1;
            }
        }
        function cellLeftOfCell(n) {
            if (n === -1) {
                return -1;
            }
            var currentRow = Math.floor(n / MAP_WIDTH);
            var newPos = n - 1;
            var newRow = Math.floor(newPos / MAP_WIDTH);
            if (currentRow != newRow) {
                return -1;
            } else {
                return newPos;
            }
        }
        function cellRightOfCell(n) {
            if (n === -1) {
                return -1;
            }
            var currentRow = Math.floor(n / MAP_WIDTH);
            var newPos = n + 1;
            var newRow = Math.floor(newPos / MAP_WIDTH);
            if (currentRow != newRow) {
                return -1;
            } else {
                return newPos;
            }
        }
        function cellIsBlocked(n) {
            var isBlocked = false;
            if (n === -1) {
                isBlocked = true;
            } else {
                var nextCell = MAP[n];
                for (var i = 0; i < MAP_WALLS.length; i++) {
                    if (nextCell === MAP_WALLS[i]) {
                        isBlocked = true;
                        break;
                    }
                }
            }
            return isBlocked;
        }
        function Player() {
            this.source = new Image();
            this.source.src = 'data:image/png;base64,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';

            this.current_frame = 0;
            this.start_frame = 0;
            this.end_frame = 0;
            this.total_frames = 9;
            this.width = CELL_WIDTH;
            this.height = CELL_HEIGHT;
            this.skip = 6; // lower is faster
            this.isMoving = false;
            this.isJumping = false;
            
            this.requestStop = false;

            this.xPos = 0;
            this.yPos = 0;
            this.xSpeed = 0;
            this.ySpeed = 0;
            this.speed = 2;
            this.distance = 0;
            this.scale = 1;
            
            this.direction = 's';
        }
        Player.prototype.stop = function() {
            if (this.direction === 'n') {
                this.faceNorth();
            } else if (this.direction === 'e') {
                this.faceEast();
            } else if (this.direction === 's') {
                this.faceSouth();
            } else if (this.direction === 'w') {
                this.faceWest();
            }
            console.log(this.distance);
        }
        Player.prototype.faceNorth = function() {
            this.isMoving = false;
            this.direction = 'n';
            this.current_frame = 3;
            this.start_frame = 3;
            this.end_frame = 5;
        }
        Player.prototype.faceEast = function() {
            this.isMoving = false;
            this.direction = 'e';
            this.current_frame = 6;
            this.start_frame = 6;
            this.end_frame = 8;
        }
        Player.prototype.faceSouth = function() {
            this.isMoving = false;
            this.direction = 's';
            this.current_frame = 0;
            this.start_frame = 0;
            this.end_frame = 2;
        }
        Player.prototype.faceWest = function() {
            this.isMoving = false;
            this.direction = 'w';
            this.current_frame = 9;
            this.start_frame = 9;
            this.end_frame = 11;
        }
        Player.prototype.turnClockwise = function() {
            if (this.direction === 'n') {
                this.faceEast();
            } else if (this.direction === 'e') {
                this.faceSouth();
            } else if (this.direction === 's') {
                this.faceWest();
            } else if (this.direction === 'w') {
                this.faceNorth();
            }
        }
        Player.prototype.turnCounterClockwise = function() {
            if (this.direction === 'n') {
                this.faceWest();
            } else if (this.direction === 'e') {
                this.faceNorth();
            } else if (this.direction === 's') {
                this.faceEast();
            } else if (this.direction === 'w') {
                this.faceSouth();
            }
        }
        Player.prototype.nextPos = function() {
            // Returns next position based on currect direction
            var row = this.yPos / this.height;
            var col = this.xPos / this.width;
            var pos = row * MAP_WIDTH + col;
            var nextPos = -1;
            if (this.direction === 'n') {
                nextPos = cellAboveCell(pos);
            } else if (this.direction === 's') {
                nextPos = cellBelowCell(pos);
            } else if (this.direction === 'w') {
                nextPos = cellLeftOfCell(pos);
            } else if (this.direction === 'e') {
                nextPos = cellRightOfCell(pos);
            }
            return nextPos;
        }
        Player.prototype.nextNextPos = function() {
            var row = this.yPos / this.height;
            var col = this.xPos / this.width;
            var pos = row * MAP_WIDTH + col;
            var nextPos = -1;
            if (this.direction === 'n') {
                nextPos = cellAboveCell(pos);
                nextPos = cellAboveCell(nextPos);
            } else if (this.direction === 's') {
                nextPos = cellBelowCell(pos);
                nextPos = cellBelowCell(nextPos);
            } else if (this.direction === 'w') {
                nextPos = cellLeftOfCell(pos);
                nextPos = cellLeftOfCell(nextPos);
            } else if (this.direction === 'e') {
                nextPos = cellRightOfCell(pos);
                nextPos = cellRightOfCell(nextPos);
            }
            return nextPos;
        }
        Player.prototype.move = function() {
            if (cellIsBlocked(this.nextPos()) === false) {
                this.isMoving = true;
                this.requestStop = false;
                this.distance = 0;
                if (this.direction === 'n') {
                    this.xSpeed = 0;
                    this.ySpeed = -this.speed;
                } else if (this.direction === 'e') {
                    this.xSpeed = this.speed;
                    this.ySpeed = 0;
                } else if (this.direction === 's') {
                    this.xSpeed = 0;
                    this.ySpeed = this.speed;
                } else if (this.direction === 'w') {
                    this.xSpeed = -this.speed;
                    this.ySpeed = 0;
                }
            }
        }
        Player.prototype.jump = function() {
            var nextNextPos = this.nextNextPos();
            if (cellIsBlocked(nextNextPos)) {
                return;
            }
            this.isJumping = true;
            this.requestStop = false;
            this.distance = 0;
            this.scale = 1;
            if (this.direction === 'n') {
                this.xSpeed = 0;
                this.ySpeed = -this.speed*2;
            } else if (this.direction === 'e') {
                this.xSpeed = this.speed*2;
                this.ySpeed = 0;
            } else if (this.direction === 's') {
                this.xSpeed = 0;
                this.ySpeed = this.speed*2;
            } else if (this.direction === 'w') {
                this.xSpeed = -this.speed*2;
                this.ySpeed = 0;
            }
        }
        Player.prototype.update = function(c, count) {
            // Draw current frame
            var xOffset = this.xPos-0.5*(this.width*this.scale-this.width);
            var yOffset = this.yPos-0.5*(this.height*this.scale-this.height);
            c.drawImage(this.source, this.current_frame * this.width, 0, this.width, this.height, xOffset, yOffset, this.width*this.scale, this.height*this.scale);
            
            if (this.requestStop) {
                // Stop is requested -- cycle through animation until first frame is reached, then set isMoving to false.
                if (this.current_frame !== this.start_frame) {
                    // Advance to next frame of animation
                    this.current_frame = this.current_frame + 1 > this.end_frame ? this.start_frame : this.current_frame + 1;
                } else {
                    this.isMoving = false;
                    this.isJumping = false;
                    this.distance = 0;
                    this.requestStop = false;
                    this.scale = 1;
                }
            } else if (this.isMoving) {
                if (count % this.skip === 0) {
                    // Advance to next frame of animation
                    this.current_frame = this.current_frame + 1 > this.end_frame ? this.start_frame : this.current_frame + 1;
                }
                // Move the position if max distance hasn't been reached for last move
                var maxDistance = (this.direction === 'n' || this.direction === 's') ? this.height : this.width;
                if (this.distance < maxDistance) {
                    this.xPos += this.xSpeed;
                    this.yPos += this.ySpeed;
                    this.distance += (Math.abs(this.xSpeed) + Math.abs(this.ySpeed));
                } else {
                    this.requestStop = true;
                }

            } else if (this.isJumping) {
	            
	            this.current_frame = this.start_frame + 1;
	            
	            var maxDistance = (this.direction === 'n' || this.direction === 's') ? 2*this.height : 2*this.width;
                if (this.distance < maxDistance) {
                    this.xPos += this.xSpeed;
                    this.yPos += this.ySpeed;
                    this.distance += (Math.abs(this.xSpeed) + Math.abs(this.ySpeed));
                    this.scale = -0.0001*Math.pow(this.distance, 2) + 0.0087*(this.distance) + 1;
                } else {
                    this.requestStop = true;
                }
            }
            
        }

        var player_obj = new Player();
        player_obj.faceSouth();

        ENTITIES.push(player_obj);
        
        function loop() {
            // clear the canvas for this loop's animation
            GAME_CONTEXT.clearRect(0, 0, GAME_CANVAS.width, GAME_CANVAS.height);
            
            // Draw map
            for (var i = 0; i < MAP.length; i++) {
                if (MAP[i] === 'W') {
                    GAME_CONTEXT.fillStyle = '#9ADFD9';
                } else if (MAP[i] === 'R') {
                    GAME_CONTEXT.fillStyle = '#EAFB7D';
                }
                GAME_CONTEXT.fillRect((i % MAP_WIDTH)*CELL_WIDTH, Math.floor(i / MAP_WIDTH)*CELL_HEIGHT, CELL_WIDTH, CELL_HEIGHT);
                
                // Draw extras
                if (MAP_PICKUPS[i] !== '0') {
	                var img = PICKUP_IMAGES[MAP_PICKUPS[i]];
	                var x = (i % MAP_WIDTH)*CELL_WIDTH;
	                var y = Math.floor(i / MAP_WIDTH)*CELL_HEIGHT;
	                var w, h;
	                if (MAP_PICKUPS[i] === 'KR') {
		                
		                var scale = (CELL_WIDTH - 2*TRANSITION_WIDTH)/img.width;
		                w = Math.floor(img.width*scale);
		                h = Math.floor(img.height*scale);
		                x = x + TRANSITION_WIDTH;
		                y = Math.floor(y + TRANSITION_WIDTH + 0.5*(CELL_HEIGHT - 2*TRANSITION_WIDTH - h));
		                GAME_CONTEXT.drawImage(img, 0, 0, img.width, img.height, x, y, w, h);
	                } else if (MAP_PICKUPS[i] === 'DR') {
		                GAME_CONTEXT.fillStyle = '#F75A00';
		                GAME_CONTEXT.fillRect(x, y, CELL_WIDTH, CELL_HEIGHT);
		                GAME_CONTEXT.fillStyle = '#FA9050';
		                GAME_CONTEXT.fillRect(x, y, CELL_WIDTH, TRANSITION_WIDTH);
		                
		                GAME_CONTEXT.fillStyle = '#444';
		                
		                GAME_CONTEXT.beginPath();
		                
		                var midX = Math.floor(x + 0.5*CELL_WIDTH);
						var midY = Math.floor(y + 0.5*CELL_HEIGHT);
	                
		                GAME_CONTEXT.arc(midX, midY-2, 4, 0, 2*Math.PI);
		                GAME_CONTEXT.moveTo(midX, midY-4);
		                GAME_CONTEXT.lineTo(midX+4, midY+8);
		                GAME_CONTEXT.lineTo(midX-4, midY+8);
		                GAME_CONTEXT.fill();
		                
		                
		                /*var scale = (CELL_WIDTH - 2*TRANSITION_WIDTH)/img.width;
		                w = Math.floor(img.width*scale);
		                h = Math.floor(img.height*scale);
		                x = x + TRANSITION_WIDTH;
		                y = Math.floor(y + TRANSITION_WIDTH + 0.5*(CELL_HEIGHT - 2*TRANSITION_WIDTH - h));
		                
		                GAME_CONTEXT.drawImage(img, 0, 0, img.width, img.height, x, y, img.width, img.height);*/
		            }
	                
                }
            }
            
            // Draw transitions
            for (var i = 0; i < MAP.length; i++) {
                if (MAP[i] === 'W') {
                    GAME_CONTEXT.fillStyle = '#8AC8C3';
                } else if (MAP[i] === 'R') {
                    GAME_CONTEXT.fillStyle = '#D2E170';
                }
                var x = (i % MAP_WIDTH)*CELL_WIDTH;
                var xx = x+CELL_WIDTH-TRANSITION_WIDTH;
                var y = Math.floor(i / MAP_WIDTH)*CELL_HEIGHT;
                var yy = y+CELL_HEIGHT-TRANSITION_WIDTH;
                switch (EDGE_TRANSITIONS[i]) {
                    case EdgeTransitions.NSWEEdgeTransition:
                        // top
                        GAME_CONTEXT.fillRect(x, y, CELL_WIDTH, TRANSITION_WIDTH);
                        // bottom
                        GAME_CONTEXT.fillRect(x, yy, CELL_WIDTH, TRANSITION_WIDTH);
                        // left
                        GAME_CONTEXT.fillRect(x, y, TRANSITION_WIDTH, CELL_HEIGHT);
                        // right
                        GAME_CONTEXT.fillRect(xx, y, TRANSITION_WIDTH, CELL_HEIGHT);
                        break;
                    case EdgeTransitions.SWEEdgeTransition:
                        // bottom
                        GAME_CONTEXT.fillRect(x, yy, CELL_WIDTH, TRANSITION_WIDTH);
                        // left
                        GAME_CONTEXT.fillRect(x, y, TRANSITION_WIDTH, CELL_HEIGHT);
                        // right
                        GAME_CONTEXT.fillRect(xx, y, TRANSITION_WIDTH, CELL_HEIGHT);
                        break;
                    case EdgeTransitions.NWEEdgeTransition:
                        // top
                        GAME_CONTEXT.fillRect(x, y, CELL_WIDTH, TRANSITION_WIDTH);
                        // left
                        GAME_CONTEXT.fillRect(x, y, TRANSITION_WIDTH, CELL_HEIGHT);
                        // right
                        GAME_CONTEXT.fillRect(xx, y, TRANSITION_WIDTH, CELL_HEIGHT);
                        break;
                    case EdgeTransitions.WEEdgeTransition:
                        // left
                        GAME_CONTEXT.fillRect(x, y, TRANSITION_WIDTH, CELL_HEIGHT);
                        // right
                        GAME_CONTEXT.fillRect(xx, y, TRANSITION_WIDTH, CELL_HEIGHT);
                        break;
                    case EdgeTransitions.NSEEdgeTransition:
                        // top
                        GAME_CONTEXT.fillRect(x, y, CELL_WIDTH, TRANSITION_WIDTH);
                        // bottom
                        GAME_CONTEXT.fillRect(x, yy, CELL_WIDTH, TRANSITION_WIDTH);
                        // right
                        GAME_CONTEXT.fillRect(xx, y, TRANSITION_WIDTH, CELL_HEIGHT);
                        break;
                    case EdgeTransitions.SEEdgeTransition:
                        // bottom
                        GAME_CONTEXT.fillRect(x, yy, CELL_WIDTH, TRANSITION_WIDTH);
                        // right
                        GAME_CONTEXT.fillRect(xx, y, TRANSITION_WIDTH, CELL_HEIGHT);
                        break;
                    case EdgeTransitions.NEEdgeTransition:
                        // top
                        GAME_CONTEXT.fillRect(x, y, CELL_WIDTH, TRANSITION_WIDTH);
                        // right
                        GAME_CONTEXT.fillRect(xx, y, TRANSITION_WIDTH, CELL_HEIGHT);
                        break;
                    case EdgeTransitions.EEdgeTransition:
                        // right
                        GAME_CONTEXT.fillRect(xx, y, TRANSITION_WIDTH, CELL_HEIGHT);
                        break;
                    case EdgeTransitions.NSWEdgeTransition:
                        // top
                        GAME_CONTEXT.fillRect(x, y, CELL_WIDTH, TRANSITION_WIDTH);
                        // bottom
                        GAME_CONTEXT.fillRect(x, yy, CELL_WIDTH, TRANSITION_WIDTH);
                        // left
                        GAME_CONTEXT.fillRect(x, y, TRANSITION_WIDTH, CELL_HEIGHT);
                        break;
                    case EdgeTransitions.SWEdgeTransition:
                        // bottom
                        GAME_CONTEXT.fillRect(x, yy, CELL_WIDTH, TRANSITION_WIDTH);
                        // left
                        GAME_CONTEXT.fillRect(x, y, TRANSITION_WIDTH, CELL_HEIGHT);
                        break;
                    case EdgeTransitions.NWEdgeTransition:
                        // top
                        GAME_CONTEXT.fillRect(x, y, CELL_WIDTH, TRANSITION_WIDTH);
                        // left
                        GAME_CONTEXT.fillRect(x, y, TRANSITION_WIDTH, CELL_HEIGHT);
                        break;
                    case EdgeTransitions.WEdgeTransition:
                        // left
                        GAME_CONTEXT.fillRect(x, y, TRANSITION_WIDTH, CELL_HEIGHT);
                        break;
                    case EdgeTransitions.NSEdgeTransition:
                        // top
                        GAME_CONTEXT.fillRect(x, y, CELL_WIDTH, TRANSITION_WIDTH);
                        // bottom
                        GAME_CONTEXT.fillRect(x, yy, CELL_WIDTH, TRANSITION_WIDTH);
                        break;
                    case EdgeTransitions.SEdgeTransition:
                        // bottom
                        GAME_CONTEXT.fillRect(x, yy, CELL_WIDTH, TRANSITION_WIDTH);
                        break;
                    case EdgeTransitions.NEdgeTransition:
                        // top
                        GAME_CONTEXT.fillRect(x, y, CELL_WIDTH, TRANSITION_WIDTH);
                        break;
                    default:
                        break;
                }
                switch (CORNER_TRANSITIONS[i]) {
                    case CornerTransitions.NWCornerTransition:
                        // NW Corner
                        GAME_CONTEXT.fillRect(x, y, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        break;
                    case CornerTransitions.NECornerTransition:
                        // NE Corner
                        GAME_CONTEXT.fillRect(xx, y, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        break;
                    case CornerTransitions.NWNECornerTransition:
                        // NW Corner
                        GAME_CONTEXT.fillRect(x, y, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        // NE Corner
                        GAME_CONTEXT.fillRect(xx, y, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        break;
                    case CornerTransitions.SWCornerTransition:
                        // SW Corner
                        GAME_CONTEXT.fillRect(x, yy, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        break;
                    case CornerTransitions.NWSWCornerTransition:
                        // NW Corner
                        GAME_CONTEXT.fillRect(x, y, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        // SW Corner
                        GAME_CONTEXT.fillRect(x, yy, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        break;
                    case CornerTransitions.NESWCornerTransition:
                        // NE Corner
                        GAME_CONTEXT.fillRect(xx, y, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        // SW Corner
                        GAME_CONTEXT.fillRect(x, yy, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        break;
                    case CornerTransitions.NWNESWCornerTransition:
                        // NW Corner
                        GAME_CONTEXT.fillRect(x, y, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        // NE Corner
                        GAME_CONTEXT.fillRect(xx, y, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        // SW Corner
                        GAME_CONTEXT.fillRect(x, yy, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        break;
                    case CornerTransitions.SECornerTransition:
                        // SE Corner
                        GAME_CONTEXT.fillRect(xx, yy, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        break;
                    case CornerTransitions.NWSECornerTransition:
                        // NW Corner
                        GAME_CONTEXT.fillRect(x, y, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        // SE Corner
                        GAME_CONTEXT.fillRect(xx, yy, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        break;
                    case CornerTransitions.NESECornerTransition:
                        // NE Corner
                        GAME_CONTEXT.fillRect(xx, y, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        // SE Corner
                        GAME_CONTEXT.fillRect(xx, yy, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        break;
                    case CornerTransitions.NWNESECornerTransition:
                        // NW Corner
                        GAME_CONTEXT.fillRect(x, y, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        // NE Corner
                        GAME_CONTEXT.fillRect(xx, y, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        // SE Corner
                        GAME_CONTEXT.fillRect(xx, yy, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        break;
                    case CornerTransitions.SWSECornerTransition:
                        // SW Corner
                        GAME_CONTEXT.fillRect(x, yy, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        // SE Corner
                        GAME_CONTEXT.fillRect(xx, yy, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        break;
                    case CornerTransitions.NWSWSECornerTransition:
                        // NW Corner
                        GAME_CONTEXT.fillRect(x, y, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        // SW Corner
                        GAME_CONTEXT.fillRect(x, yy, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        // SE Corner
                        GAME_CONTEXT.fillRect(xx, yy, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        break;
                    case CornerTransitions.NESWSECornerTransition:
                        // NE Corner
                        GAME_CONTEXT.fillRect(xx, y, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        // SW Corner
                        GAME_CONTEXT.fillRect(x, yy, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        // SE Corner
                        GAME_CONTEXT.fillRect(xx, yy, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        break;
                    case CornerTransitions.NWNESWSECornerTransition:
                        // NW Corner
                        GAME_CONTEXT.fillRect(x, y, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        // NE Corner
                        GAME_CONTEXT.fillRect(xx, y, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        // SW Corner
                        GAME_CONTEXT.fillRect(x, yy, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        // SE Corner
                        GAME_CONTEXT.fillRect(xx, yy, TRANSITION_WIDTH, TRANSITION_WIDTH);
                        break;
                    default:
                        break;
                }
            }
            
            // Draw grid
            GAME_CONTEXT.fillStyle = '#DDD';
            for (var i = 1; i < 10; i++) {
                //GAME_CONTEXT.fillRect(i*CELL_WIDTH, 0, 1, GAME_CANVAS.height);
            }
            for (var i = 1; i < 10; i++) {
                //GAME_CONTEXT.fillRect(0, i*CELL_HEIGHT, GAME_CANVAS.width, 1);
            }

            for (var i = 0; i < ENTITIES.length; i++) {
                var e = ENTITIES[i];
                e.update(GAME_CONTEXT, GAME_COUNT);
            }

            GAME_COUNT = GAME_COUNT + 1 > 999 ? 0 : GAME_COUNT + 1;
        }

        function start() {
            document.getElementById('pause').onclick = function() {
                if (GAME_TIMER != null) {
                    clearTimeout(GAME_TIMER);
                    GAME_TIMER = null;
                    document.getElementById('pause').value = 'Start';
                } else {
                    GAME_TIMER = setInterval(loop, TIMER_SPEED);
                    document.getElementById('pause').value = 'Pause';
                }
            }
            document.getElementById('go').onclick = function() {
	            if (IS_EXE) {
		            return;
	            }
	            IS_EXE = true;
                var commandsString = document.getElementById('commands').value;
                var commands = commandsString.split(" ");
                
                var speed = 800;
                for (var i = 0; i < commands.length; i++) {
                    var command = commands[i];
                    if (command === 'c') {
                        setTimeout(function(){player_obj.turnClockwise();}, speed*i);
                    }
                    if (command === 'cc') {
                        setTimeout(function(){player_obj.turnCounterClockwise();}, speed*i);
                    }
                    if (command === 'm') {
                        setTimeout(function(){player_obj.move();}, speed*i);
                    }
                    if (command === 'j') {
	                    setTimeout(function(){player_obj.jump();}, speed*i);
                    }
                    if (i === commands.length-1) setTimeout(function(){IS_EXE = false;}, speed*i);
                }
            }
            
            GAME_CANVAS = document.getElementById('game');
            if (GAME_CANVAS.getContext) {
                GAME_CONTEXT = GAME_CANVAS.getContext('2d');
                
                if (window.devicePixelRatio == 2) {
					GAME_CANVAS.setAttribute('width', 720);
					GAME_CANVAS.setAttribute('height', 920);
					GAME_CONTEXT.scale(2, 2);
				}
                
                GAME_COUNT = 0;
                GAME_TIMER = setInterval(loop, TIMER_SPEED);
            }
        }
        function cellHasTopEdgeTransition(n) {
            if (EDGE_TRANSITIONS[n] === EdgeTransitions.NSWEEdgeTransition ||
                EDGE_TRANSITIONS[n] === EdgeTransitions.NWEEdgeTransition ||
                EDGE_TRANSITIONS[n] === EdgeTransitions.NSEEdgeTransition ||
                EDGE_TRANSITIONS[n] === EdgeTransitions.NEEdgeTransition ||
                EDGE_TRANSITIONS[n] === EdgeTransitions.NSWEdgeTransition ||
                EDGE_TRANSITIONS[n] === EdgeTransitions.NWEdgeTransition ||
                EDGE_TRANSITIONS[n] === EdgeTransitions.NSEdgeTransition ||
                EDGE_TRANSITIONS[n] === EdgeTransitions.NEdgeTransition) {
                    return true;
                } else {
                    return false;
                }
        }
        function cellHasBottomEdgeTransition(n) {
            if (EDGE_TRANSITIONS[n] === EdgeTransitions.NSWEEdgeTransition ||
                EDGE_TRANSITIONS[n] === EdgeTransitions.SWEEdgeTransition ||
                EDGE_TRANSITIONS[n] === EdgeTransitions.NSEEdgeTransition ||
                EDGE_TRANSITIONS[n] === EdgeTransitions.SEEdgeTransition ||
                EDGE_TRANSITIONS[n] === EdgeTransitions.NSWEdgeTransition ||
                EDGE_TRANSITIONS[n] === EdgeTransitions.SWEdgeTransition ||
                EDGE_TRANSITIONS[n] === EdgeTransitions.NSEdgeTransition ||
                EDGE_TRANSITIONS[n] === EdgeTransitions.SEdgeTransition) {
                    return true;
                } else {
                    return false;
                }
        }
        function cellHasLeftEdgeTransition(n) {
            if (EDGE_TRANSITIONS[n] === EdgeTransitions.NSWEEdgeTransition ||
                EDGE_TRANSITIONS[n] === EdgeTransitions.SWEEdgeTransition ||
                EDGE_TRANSITIONS[n] === EdgeTransitions.NWEEdgeTransition ||
                EDGE_TRANSITIONS[n] === EdgeTransitions.WEEdgeTransition ||
                EDGE_TRANSITIONS[n] === EdgeTransitions.NSWEdgeTransition ||
                EDGE_TRANSITIONS[n] === EdgeTransitions.SWEdgeTransition ||
                EDGE_TRANSITIONS[n] === EdgeTransitions.NWEdgeTransition ||
                EDGE_TRANSITIONS[n] === EdgeTransitions.WEdgeTransition) {
                    return true;
                } else {
                    return false;
                }
        }
        function cellHasRightEdgeTransition(n) {
            if (EDGE_TRANSITIONS[n] === EdgeTransitions.NSWEEdgeTransition ||
                EDGE_TRANSITIONS[n] === EdgeTransitions.SWEEdgeTransition ||
                EDGE_TRANSITIONS[n] === EdgeTransitions.NWEEdgeTransition ||
                EDGE_TRANSITIONS[n] === EdgeTransitions.WEEdgeTransition ||
                EDGE_TRANSITIONS[n] === EdgeTransitions.NSEEdgeTransition ||
                EDGE_TRANSITIONS[n] === EdgeTransitions.SEEdgeTransition ||
                EDGE_TRANSITIONS[n] === EdgeTransitions.NEEdgeTransition ||
                EDGE_TRANSITIONS[n] === EdgeTransitions.EEdgeTransition) {
                    return true;
                } else {
                    return false;
                }
        }
        function calculateEdgeTransitions() {
            for (var i = 0; i < MAP.length; i++) {
                var edgeTransition = 0;
                if (true) {
                    var top = cellAboveCell(i);
                    var bottom = cellBelowCell(i);
                    var left = cellLeftOfCell(i);
                    var right = cellRightOfCell(i);
                    if (top !== -1 && MAP[top] === MAP[i]) {
                        edgeTransition = 2;
                    }
                    if (bottom !== -1 && MAP[bottom] === MAP[i]) {
                        edgeTransition = edgeTransition | 4;
                    }
                    if (left !== -1 && MAP[left] === MAP[i]) {
                        edgeTransition = edgeTransition | 8;
                    }
                    if (right !== -1 && MAP[right] === MAP[i]) {
                        edgeTransition = edgeTransition | 16;
                    }
                } else {
                    edgeTransition = -1;
                }
                EDGE_TRANSITIONS.push(edgeTransition);
            }
        }
        function calculateCornerTransitions() {
            for (var i = 0; i < MAP.length; i++) {
                var cornerTransition = 0;
                if (true) {
                    var top = cellAboveCell(i);
                    var bottom = cellBelowCell(i);
                    var left = cellLeftOfCell(i);
                    var right = cellRightOfCell(i);
                    if (top !== -1 && left !== -1 && MAP[top] === MAP[i] && MAP[left] === MAP[i] && cellHasLeftEdgeTransition(top) && cellHasTopEdgeTransition(left)) {
                        cornerTransition = 2;
                    }
                    if (top !== -1 && right !== -1 && MAP[top] === MAP[i] && MAP[right] === MAP[i] && cellHasRightEdgeTransition(top) && cellHasTopEdgeTransition(right)) {
                        cornerTransition = cornerTransition | 4;
                    }
                    if (bottom !== -1 && left !== -1 && MAP[bottom] === MAP[i] && MAP[left] === MAP[i] && cellHasLeftEdgeTransition(bottom) && cellHasBottomEdgeTransition(left)) {
                        cornerTransition = cornerTransition | 8;
                    }
                    if (bottom !== -1 && right !== -1 && MAP[bottom] === MAP[i] && MAP[right] === MAP[i] && cellHasRightEdgeTransition(bottom) && cellHasBottomEdgeTransition(right)) {
                        cornerTransition = cornerTransition | 16;
                    }
                } else {
                    cornerTransition = -1;
                }
                CORNER_TRANSITIONS.push(cornerTransition);
            }
        }
    </script>
    <style type="text/css">
        body {
            padding: 0;
            margin: 0;
        }
        canvas {
	        width: 360px;
	        height: 460px;
        }
        div#command-container {
	        padding: 10px;
        }
        form {
            width: 220px;
        }
        #commands {
            width: 99%;
            height: 100px;
        }
    </style>
</head>

<body onload="start();">
    <div id="container">
        <canvas height="460" id="game" width="360"></canvas>
        <div id="command-container">
	        <form>
	            <textarea id="commands"></textarea><br>
	            <input type="button" value="Go" id="go" />
	            <input type="button" value="Pause" id="pause" />
	        </form>
        </div>
    </div>
</body>

</html>
